#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

my $event = "nethserver-phonebook-mysql-update";

event_actions ($event , qw(
    initialize-default-databases 00
    nethserver-phonebook-mysql-install 30
    nethserver-unixODBC-conf 40
    nethserver-phonebook-mysql-conf 60
));

templates2events ('/etc/odbc.ini',$event);
templates2events ('/etc/init/slapd.conf',$event);


#
# If domain changes, set new LDAP ACL
#
event_actions('hostname-modify', qw(
    nethserver-phonebook-mysql-conf 30
));


#expand db template on migration and update db password
templates2events ('/usr/share/phonebooks/phonebook.sql',"migration-import");
event_actions("migration-import", 'nethserver-phonebook-mysql-install' => 75);

#expand slapd init configuration file template on nethserver-directory-update, to force it to star after mysqld. Refs #3950
templates2events ('/etc/init/slapd.conf','nethserver-directory-update');

